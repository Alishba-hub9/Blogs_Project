AOS.init();let blogStylingTemplate=t=>`
    <a class="blog-title-link" href="blogs?id=${t.id}">
        <h2 class="blog-title">${t.title}</h2>
        <h3 class="blog-subtitle">${t.subtitle}</h3>
    </a>
        <p class="blog-meta">Posted by <a href="javascript:void(0)">${t.author}</a> on ${t.posted_at}</p>
    <hr class="my-4">
`,singleBlogDisplayTemplate=t=>`
    <h1 class="blog-post-title">${t.title}</h1>
    <p class="sub-heading-blog">${t.subtitle}</p>
    <p class="blog-meta">Posted by <a href="javascript:void(0)">${t.author}</a> on ${t.posted_at}</p>
`,dashboardBlogDisplayTemplate=t=>`
    <div class="blog-card" data-id="${t.id}">
        <div class="text-controller-div">
            <div class="view-mode">
                <h3>${t.title}</h3>
                <p>${t.subtitle}</p>
                <p>Author: ${t.author}</p>
                <p>${t.content}</p>
            </div>
            <div class="edit-mode">
                <h3>Edit Your Blog</h3>
                <input type="text" class="edit-input" data-key="title" value="${t.title}" placeholder="Title"><br>
                <input type="text" class="edit-input" data-key="subtitle" value="${t.subtitle}" placeholder="Subtitle"><br>
                <input type="text" class="edit-input" data-key="author" value="${t.author}" placeholder="Author"><br>
                <textarea class="edit-input" data-key="content" id="content" placeholder="Content">${t.content}</textarea><br>
                <button class="save-btn" data-id="${t.id}">Save</button>
                <button class="cancel-btn" data-id="${t.id}">Cancel</button>
            </div>
        </div>
        <div class="actions">
            <button class="edit-btn" data-id="${t.id}"><i class="fas fa-pencil-alt"></i> Edit</button>
            <button class="delete-btn" data-id="${t.id}"><i class="fa-solid fa-trash"></i> Delete</button>
        </div>
    </div>
`,noBlogsMessage=()=>`
  <div class="no-blogs-message">
    <p>No blogs available at the moment.</p>
  </div>
`,showToast=(t,a="success")=>{Toastify({text:t,duration:3e3,close:!0,gravity:"top",position:"right",style:{background:"success"===a?"#28a745":"#dc3545"}}).showToast()},toggleButton=(t,a)=>{t.prop("disabled",a)},baseURL=window.location.pathname.includes("admin/")?"../includes/blogs_db.php":"includes/blogs_db.php",loadBlogsData=async(t="all")=>{try{var a,e=await $.ajax({url:baseURL,method:"GET",dataType:"json",data:{method:"get_all",scope:t}});"success"===e.status&&0<e.blogs?.length?($(".dashboard-blogs").html(e.blogs.map(dashboardBlogDisplayTemplate).join("")),$(".blog-posts-content").html(e.blogs.map(blogStylingTemplate).join(""))):(a=noBlogsMessage(),$(".dashboard-blogs").html(a),$(".blog-posts-content").html(a))}catch(t){console.error("Error Fetching Blogs To Page:",t)}},fetchSingleBlog=async t=>{try{var a=await $.ajax({url:baseURL,method:"GET",data:{method:"get_single_blog",id:t},dataType:"json"});"success"===a.status&&a.get_single_blog&&($(".blogs-header-content").html(singleBlogDisplayTemplate(a.get_single_blog)),$(".single-blog-body-content").html(a.get_single_blog.content))}catch(t){showToast("Failed to retrieve blog. Please try again later.","error")}},lastScrollTop=(document.URL.includes("blogs")&&fetchSingleBlog(new URLSearchParams(window.location.search).get("id")),$(".login-form").on("submit",async t=>{t.preventDefault();var t=$(t.currentTarget),a=t.find("button[type='submit']"),t=(toggleButton(a,!0),t.serialize());try{var e=await $.ajax({url:"includes/login.php",method:"POST",data:t,dataType:"json"});e.success?window.location.href="admin/dashboard":showToast(e.message,"error")}catch(t){showToast("Something went wrong. Try again.","error")}finally{toggleButton(a,!1)}}),$(".register-form").on("submit",async t=>{t.preventDefault();var t=$(t.currentTarget),a=t.find("button[type='submit']"),e=(toggleButton(a,!0),t.serialize());try{var o=await $.ajax({url:"includes/signup.php",method:"POST",data:e,dataType:"json"});showToast(o.message,o.success?"success":"error"),o.success&&t[0].reset()}catch(t){showToast("Something went wrong. Try again.","error")}finally{toggleButton(a,!1)}}),$(".blog-data-form").on("submit",async t=>{t.preventDefault();var a=$(t.currentTarget),e=a.find("button[type='submit']"),t=(toggleButton(e,!0),new FormData(t.currentTarget));t.set("content",tinymce.get("content").getContent());try{var o=await $.ajax({url:"../includes/blogs_db.php",method:"POST",data:t,processData:!1,contentType:!1,dataType:"json"});"success"===o.status?(showToast("Blog posted successfully!"),a[0].reset()):showToast(o.message,"error")}catch(t){showToast("Error posting blog","error")}finally{toggleButton(e,!1)}}),$(".dashboard-blogs").on("click",".edit-btn",async t=>{var t=$(t.currentTarget).closest(".blog-card"),a=t.data("id");$(".dashboard-blogs").addClass("edit-mode-active"),$(".dashboard-blogs .actions").hide();try{"success"===(await $.ajax({url:"../includes/blogs_db.php",method:"GET",data:{method:"get_single_blog",id:a},dataType:"json"})).status&&(t.find(".view-mode").hide(),t.find(".edit-mode").show())}catch(t){showToast("Error fetching blog data","error")}}),$(".dashboard-blogs").on("click",".save-btn",async t=>{var a=$(t.currentTarget),t=(toggleButton(a,!0),$(t.currentTarget).closest(".blog-card")),e=t.data("id");$(".dashboard-blogs").removeClass("edit-mode-active");let o={id:e};t.find(".edit-input").each(function(){o[$(this).data("key")]=$(this).val()}),o.content=tinymce.get("content").getContent();try{"success"===(await $.ajax({url:"../includes/blogs_db.php",method:"PATCH",data:JSON.stringify(o),contentType:"application/json",dataType:"json"})).status&&(loadBlogsData("user"),t.find(".edit-mode").hide(),t.find(".view-mode").show(),showToast("Blog updated successfully!"))}catch(t){showToast("Error updating blog","error")}finally{toggleButton(a,!1)}}),$(".dashboard-blogs").on("click",".cancel-btn",t=>{t=$(t.currentTarget).closest(".blog-card");t.find(".edit-mode").hide(),t.find(".view-mode").show(),t.find(".actions").show(),$(".dashboard-blogs").removeClass("edit-mode-active")}),$(".dashboard-blogs").on("click",".delete-btn",async t=>{var a=$(t.currentTarget),e=(toggleButton(a,!0),$(t.currentTarget).data("id"));let o=$(t.currentTarget).closest(".blog-card");try{await $.ajax({url:"../includes/blogs_db.php",method:"DELETE",data:JSON.stringify({id:e}),contentType:"application/json",dataType:"json"}),o.fadeOut(300,()=>o.remove()),showToast("Blog deleted successfully!")}catch(t){showToast("Error deleting blog","error")}finally{toggleButton(a,!1)}}),$(".search-field").on("input",".blog-search",async function(){let e=$(this).val().trim().toLowerCase(),o=$(this).siblings(".suggestions").empty().hide();if(e)try{var t=await $.ajax({url:"includes/search.php",method:"GET",data:{query:e},dataType:"json"});t.length?(t.forEach(t=>{var a=$(".suggestion-template .search-result").clone(),t=(a.attr("data-id",t.id),t.title.replace(new RegExp(e,"gi"),t=>`<span class='highlighted-search-text'>${t}</span>`));a.find(".result-title").html(t),a.hide().appendTo(o).fadeIn(200)}),o.show()):o.html("<div class='no-result'>No results found</div>").show()}catch(t){showToast("Error fetching search results","error")}}),$(".search-field").on("submit",function(t){t.preventDefault();t=$(this).find(".suggestions .search-result").first().data("id");t&&(window.location.href="blogs?id="+t,$(this).find(".blog-search").val(""))}),$(".search-field").on("click",".search-result",function(){var t=$(this).data("id");t&&(window.location.href="blogs?id="+t,$(".blog-search").val(""))}),window.location.pathname.includes("home")&&loadBlogsData("all"),window.location.pathname.includes("dashboard")&&loadBlogsData("user"),$(".search-text-button").on("click",t=>{t.stopPropagation(),$(".search-field").toggleClass("search-field-active")}),0),navbar=$(".header-navbar"),floatingBtn=$(".floating-btn"),blogSection=$(".blog-posts-content");$(window).on("scroll",()=>{var t=$(window).scrollTop();t>lastScrollTop||0===t?navbar.removeClass("sticky"):navbar.addClass("sticky"),lastScrollTop=t}),$(window).on("scroll",()=>{var t=$(window).scrollTop();blogSection.offset().top+200<t+$(window).height()?floatingBtn.fadeOut():floatingBtn.fadeIn(),lastScrollTop=t}),$(".floating-btn").on("click",()=>{$("html, body").animate({scrollTop:blogSection.offset().top},100)});